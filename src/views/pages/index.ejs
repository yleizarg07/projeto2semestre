<%- include('../partials/head') %>
<%- include('../partials/header') %>

<div class="container mt-4" style="max-width:1100px;">
<div class="row">
<!-- Feed -->
<div class="col-md-8">
<div class="d-flex justify-content-between align-items-center mb-3">
<h3>Ãšltimos Posts</h3>

<% if (session && session.idUsuario) { %>
      <a href="/postagens/criar" class="btn btn-primary">Criar nova postagem</a>
    <% } else { %>
      <a href="/login" class="btn btn-outline-primary">Entrar para publicar</a>
    <% } %>
  </div>

  <% if (postagens && postagens.length > 0) { %>
    <% postagens.forEach(p => { %>
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex align-items-center mb-2">
            <img src="/img/default.png" width="48" class="rounded-circle me-3">
            <div>
              <strong>@<%= p.nomeUsuario %></strong><br>
              <small class="text-muted"><%= p.categoria || 'Geral' %></small>
            </div>
          </div>

          <h5><%= p.titulo %></h5>
          <p><%= p.conteudo %></p>

          <div>
            <a href="/postagem/<%= p.idPost %>" class="me-3">Ver</a>
            <% if (session && session.idUsuario === p.postUsuario) { %>
              <a href="/postagens/editar/<%= p.idPost %>" class="me-2">Editar</a>

              <form action="/postagens/excluir/<%= p.idPost %>" method="POST" style="display:inline;">
                <button class="btn btn-sm btn-link text-danger">Excluir</button>
              </form>
            <% } %>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <p>Nenhum post encontrado.</p>
  <% } %>
</div>

<div class="col-md-4">

  <%- include('../partials/sidebar', { usuarios:usuarios }) %>
</div>
</div>
</div>
<%- include('../partials/footer') %>