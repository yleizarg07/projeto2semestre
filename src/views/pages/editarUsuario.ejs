<%- include('../partials/head') %>
<%- include('../partials/header') %>

<div class="container mt-5 container-medio">

    <h2>Editar Informações do Usuário</h2>

    <% if (typeof error !== "undefined" && error) { %>
        <div class="alert alert-danger mt-3 mb-3">
            <i class="bi bi-exclamation-triangle-fill"></i> <%= error %>
        </div>
    <% } %>

    <form action="/usuarios/atualizar/<%= usuario.idUsuario %>" method="POST">

        <div class="mb-3">
            <label class="form-label">Nome</label>
            <input type="text" name="nome" class="form-control" 
                   value="<%= usuario.nome %>" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Nome de Usuário</label>
            <input type="text" name="nomeUsuario" class="form-control" 
                   value="<%= usuario.nome_usuario %>" required>
        </div>

        <div class="mb-3 position-relative input-icon-container">
            <label for="senhaAtual" class="form-label">Senha Atual</label>

            <input 
                type="password" 
                class="form-control" 
                id="senhaAtual" 
                name="senhaAtual"
                placeholder="Digite sua senha atual"
            >

            <i class="bi bi-eye-slash icon-senha" id="toggleSenhaAtual"></i>
        </div>

        <div class="mb-3 position-relative input-icon-container">
            <label for="senha" class="form-label">Nova Senha</label>

            <input 
                type="password" 
                class="form-control" 
                id="senha" 
                name="senha"
                placeholder="Digite a nova senha"
            >

            <i class="bi bi-eye-slash icon-senha" id="toggleSenha"></i>
        </div>

        <div class="mb-3 position-relative input-icon-container">
            <label for="senha2" class="form-label fw-semibold">Confirme sua Senha</label>

            <input 
                type="password" 
                class="form-control" 
                id="senha2" 
                name="senha2"
            >

            <i class="bi bi-eye-slash icon-senha" id="toggleSenha2"></i>
        </div>

        <button type="submit" class="btn btn-primary">Salvar alterações</button>

        <button 
            type="button" 
            class="btn btn-danger ms-2" 
            data-bs-toggle="modal" 
            data-bs-target="#modalExcluir">
            Excluir Usuário
        </button>
    </form>
</div>

<!-- Modal -->
<div class="modal fade" id="modalExcluir" tabindex="-1" aria-labelledby="modalExcluirLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="modalExcluirLabel">Confirmar Exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                Tem certeza que deseja <strong>excluir este usuário</strong>?  
                Esta ação é permanente.
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

                <form action="/usuarios/remover/<%= usuario.idUsuario %>" method="POST">
                    <button type="submit" class="btn btn-danger">Excluir Usuário</button>
                </form>
            </div>

        </div>
    </div>
</div>

<%- include('../partials/footer') %>

<script>
// Ativa required quando digitar a nova senha
document.getElementById("senha").addEventListener("input", function () {
    const senha2 = document.getElementById("senha2");
    senha2.required = this.value.trim() !== "";
});
</script>

<script>
function toggleSenha(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);

    if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("bi-eye-slash", "bi-eye");
    } else {
        input.type = "password";
        icon.classList.replace("bi-eye", "bi-eye-slash");
    }
}

document.getElementById("toggleSenha").onclick = () =>
    toggleSenha("senha", "toggleSenha");

document.getElementById("toggleSenha2").onclick = () =>
    toggleSenha("senha2", "toggleSenha2");

document.getElementById("toggleSenhaAtual").onclick = () =>
    toggleSenha("senhaAtual", "toggleSenhaAtual");
</script>
<%- include('../partials/footer') %>
